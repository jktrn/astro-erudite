- Start
- Guides and recipes
- Reference
- Integrations
- Third-party services
- Getting started
- Welcome, world!
								
							
							
	



						
						
	
				
						Why Astro?
						
					
			
				
						Islands architecture
						
					
			
				
						Tutorial: Build a blog
						
					
			
				
						Courses
- Why Astro?
- Islands architecture
- Tutorial: Build a blog
- Courses
- Start a new project
								
							
							
	



						
						
	
				
						Installation
						
					
			
				
						Project structure
						
					
			
				
						Develop and build
- Installation
- Project structure
- Develop and build
- Configuration
								
							
							
	



						
						
	
				
						Configuration overview
						
					
			
				
						Editor setup
						
					
			
				
						TypeScript
						
					
			
				
						Environment variables
						
					
			
				
						Build with AI
						
					
			
				
						Dev toolbar
- Configuration overview
- Editor setup
- TypeScript
- Environment variables
- Build with AI
- Dev toolbar
- Migrate to Astro
								
							
							
	



						
						
	
				
						Site migration overview
						
					
			
				
						Create React App
						
					
			
				
						Docusaurus
						
					
			
				
						Eleventy
						
					
			
				
						Gatsby
						
					
			
				
						GitBook
						
					
			
				
						Gridsome
						
					
			
				
						Hugo
						
					
			
				
						Jekyll
						
					
			
				
						Next.js
						
					
			
				
						NuxtJS
						
					
			
				
						Pelican
						
					
			
				
						SvelteKit
						
					
			
				
						VuePress
						
					
			
				
						WordPress
- Site migration overview
- Create React App
- Docusaurus
- Eleventy
- Gatsby
- GitBook
- Gridsome
- Hugo
- Jekyll
- Next.js
- NuxtJS
- Pelican
- SvelteKit
- VuePress
- WordPress
- Routing and navigation
								
							
							
	



						
						
	
				
						Pages
						
					
			
				
						Routing
						
					
			
				
						Endpoints
						
					
			
				
						Middleware
						
					
			
				
						Internationalization (i18n)
						
					
			
				
						Prefetch
						
					
			
				
						View transitions
- Pages
- Routing
- Endpoints
- Middleware
- Internationalization (i18n)
- Prefetch
- View transitions
- Build your UI
								
							
							
	



						
						
	
				
						Components
						
					
			
				
						Layouts
						
					
			
				
						Styles and CSS
						
					
			
				
						Fonts
						
					
			
				
						Syntax Highlighting
						
					
			
				
						Scripts and event handling
						
					
			
				
						Front-end frameworks
- Components
- Layouts
- Styles and CSS
- Fonts
- Syntax Highlighting
- Scripts and event handling
- Front-end frameworks
- Add content to your site
								
							
							
	



						
						
	
				
						Markdown
						
					
			
				
						Content collections
						
					
			
				
						Images
						
					
			
				
						Data fetching
						
					
			
				
						Astro DB
- Markdown
- Content collections
- Images
- Data fetching
- Astro DB
- Server rendering
								
							
							
	



						
						
	
				
						On-demand rendering
						
					
			
				
						Server islands
						
					
			
				
						Actions
						
					
			
				
						Sessions
- On-demand rendering
- Server islands
- Actions
- Sessions
- Upgrade
								
							
							
	



						
						
	
				
						Upgrade Astro
						
					
			
				
						
						
							
								Major upgrade guides
								
							
							
	



						
						
	
				
						v5.0
						
					
			
				
						v4.0
						
					
			
				
						v3.0
						
					
			
				
						v2.0
						
					
			
				
						v1.0
- Upgrade Astro
- Major upgrade guides
								
							
							
	



						
						
	
				
						v5.0
						
					
			
				
						v4.0
						
					
			
				
						v3.0
						
					
			
				
						v2.0
						
					
			
				
						v1.0
- v5.0
- v4.0
- v3.0
- v2.0
- v1.0
- Troubleshooting
- How-to recipes
								
							
							
	



						
						
	
				
						Recipes overview
						
					
			
				
						Installing a Vite or Rollup plugin
						
					
			
				
						Analyze bundle size
						
					
			
				
						Build a custom image component
						
					
			
				
						Build HTML forms in Astro pages
						
					
			
				
						Build forms with API routes
						
					
			
				
						Use Bun with Astro
						
					
			
				
						Call endpoints from the server
						
					
			
				
						Verify a Captcha
						
					
			
				
						Customize file names in the build output
						
					
			
				
						Build your Astro site with Docker
						
					
			
				
						Dynamically import images
						
					
			
				
						Add icons to external links
						
					
			
				
						Add i18n features
						
					
			
				
						Create a dev toolbar app
						
					
			
				
						Add last modified time
						
					
			
				
						Add reading time
						
					
			
				
						Add an RSS feed
						
					
			
				
						Share state between Astro components
						
					
			
				
						Share state between islands
						
					
			
				
						Using streaming to improve page performance
						
					
			
				
						Style rendered Markdown with Tailwind Typography
- Recipes overview
- Installing a Vite or Rollup plugin
- Analyze bundle size
- Build a custom image component
- Build HTML forms in Astro pages
- Build forms with API routes
- Use Bun with Astro
- Call endpoints from the server
- Verify a Captcha
- Customize file names in the build output
- Build your Astro site with Docker
- Dynamically import images
- Add icons to external links
- Add i18n features
- Create a dev toolbar app
- Add last modified time
- Add reading time
- Add an RSS feed
- Share state between Astro components
- Share state between islands
- Using streaming to improve page performance
- Style rendered Markdown with Tailwind Typography
- Contribute to Astro
- Astro Template Syntax
- Configuration Reference
- CLI Commands
- Imports reference
- Routing Reference
- Runtime API
Render context
astro:actions
astro:assets
astro:config
astro:content
astro:env
astro:i18n
astro:middleware
astro:transitions
- Render context
- astro:actions
- astro:assets
- astro:config
- astro:content
- astro:env
- astro:i18n
- astro:middleware
- astro:transitions
- Other development APIs
Integration API
Adapter API
Content Loader API
Image Service API
Dev Toolbar App API
Container API (experimental)
Programmatic Astro API (experimental)
- Integration API
- Adapter API
- Content Loader API
- Image Service API
- Dev Toolbar App API
- Container API (experimental)
- Programmatic Astro API (experimental)
- Experimental features
Configuring experimental flags
Content Security Policy
Fonts
Live content collections
Client prerendering
Intellisense for collections
Preserve scripts order
Markdown heading ID compatibility
Private meta environment variables inlining
Chrome DevTools workspace
Prerender conflict error
SVG optimization
- Configuring experimental flags
- Content Security Policy
- Fonts
- Live content collections
- Client prerendering
- Intellisense for collections
- Preserve scripts order
- Markdown heading ID compatibility
- Private meta environment variables inlining
- Chrome DevTools workspace
- Prerender conflict error
- SVG optimization
- Legacy flags
- Error reference
- Integrations overview
- UI frameworks
								
							
							
	



						
						
	
				
						Alpine.js
						
					
			
				
						Preact
						
					
			
				
						React
						
					
			
				
						SolidJS
						
					
			
				
						Svelte
						
					
			
				
						Vue
- Alpine.js
- Preact
- React
- SolidJS
- Svelte
- Vue
- Adapters
								
							
							
	



						
						
	
				
						Cloudflare
						
					
			
				
						Netlify
						
					
			
				
						Node
						
					
			
				
						Vercel
- Cloudflare
- Netlify
- Node
- Vercel
- Other official integrations
								
							
							
	



						
						
	
				
						DB
						
					
			
				
						Markdoc
						
					
			
				
						MDX
						
					
			
				
						Partytown
						
					
			
				
						Sitemap
- DB
- Markdoc
- MDX
- Partytown
- Sitemap
- Publish to npm
- Deployment guides
								
							
							
	



						
						
	
				
						Deployment overview
						
					
			
				
						AWS
						
					
			
				
						AWS via Flightcontrol
						
					
			
				
						AWS via SST
						
					
			
				
						Azion
						
					
			
				
						Buddy
						
					
			
				
						Cleavr
						
					
			
				
						Clever Cloud
						
					
			
				
						Cloudflare
						
					
			
				
						CloudRay
						
					
			
				
						Deno Deploy
						
					
			
				
						DeployHQ
						
					
			
				
						Firebase
						
					
			
				
						Fleek
						
					
			
				
						Fly.io
						
					
			
				
						GitHub Pages
						
					
			
				
						GitLab Pages
						
					
			
				
						Google Cloud
						
					
			
				
						Heroku
						
					
			
				
						Juno
						
					
			
				
						Kinsta
						
					
			
				
						Microsoft Azure
						
					
			
				
						Netlify
						
					
			
				
						Railway
						
					
			
				
						Render
						
					
			
				
						Seenode
						
					
			
				
						Stormkit
						
					
			
				
						Surge
						
					
			
				
						Vercel
						
					
			
				
						Zeabur
						
					
			
				
						Zephyr Cloud
						
					
			
				
						Zerops
- Deployment overview
- AWS
- AWS via Flightcontrol
- AWS via SST
- Azion
- Buddy
- Cleavr
- Clever Cloud
- Cloudflare
- CloudRay
- Deno Deploy
- DeployHQ
- Firebase
- Fleek
- Fly.io
- GitHub Pages
- GitLab Pages
- Google Cloud
- Heroku
- Juno
- Kinsta
- Microsoft Azure
- Netlify
- Railway
- Render
- Seenode
- Stormkit
- Surge
- Vercel
- Zeabur
- Zephyr Cloud
- Zerops
- Content management systems
								
							
							
	



						
						
	
				
						CMS overview
						
					
			
				
						ApostropheCMS
						
					
			
				
						Builder.io
						
					
			
				
						ButterCMS
						
					
			
				
						Caisy
						
					
			
				
						CloudCannon
						
					
			
				
						Contentful
						
					
			
				
						Cosmic
						
					
			
				
						Craft CMS
						
					
			
				
						Craft Cross CMS
						
					
			
				
						Crystallize
						
					
			
				
						DatoCMS
						
					
			
				
						Decap CMS
						
					
			
				
						Directus
						
					
			
				
						Drupal
						
					
			
				
						Flotiq
						
					
			
				
						Front Matter CMS
						
					
			
				
						Ghost
						
					
			
				
						GitCMS
						
					
			
				
						Hashnode
						
					
			
				
						Hygraph
						
					
			
				
						JekyllPad
						
					
			
				
						Keystatic
						
					
			
				
						KeystoneJS
						
					
			
				
						Kontent.ai
						
					
			
				
						microCMS
						
					
			
				
						Optimizely CMS
						
					
			
				
						Payload CMS
						
					
			
				
						Prepr CMS
						
					
			
				
						Prismic
						
					
			
				
						Sanity
						
					
			
				
						Sitecore XM
						
					
			
				
						Sitepins
						
					
			
				
						Spinal
						
					
			
				
						Statamic
						
					
			
				
						Storyblok
						
					
			
				
						Strapi
						
					
			
				
						StudioCMS
						
					
			
				
						Tina CMS
						
					
			
				
						Umbraco
						
					
			
				
						Wordpress
- CMS overview
- ApostropheCMS
- Builder.io
- ButterCMS
- Caisy
- CloudCannon
- Contentful
- Cosmic
- Craft CMS
- Craft Cross CMS
- Crystallize
- DatoCMS
- Decap CMS
- Directus
- Drupal
- Flotiq
- Front Matter CMS
- Ghost
- GitCMS
- Hashnode
- Hygraph
- JekyllPad
- Keystatic
- KeystoneJS
- Kontent.ai
- microCMS
- Optimizely CMS
- Payload CMS
- Prepr CMS
- Prismic
- Sanity
- Sitecore XM
- Sitepins
- Spinal
- Statamic
- Storyblok
- Strapi
- StudioCMS
- Tina CMS
- Umbraco
- Wordpress
- Backend services
								
							
							
	



						
						
	
				
						Backend services overview
						
					
			
				
						Appwrite
						
					
			
				
						Firebase
						
					
			
				
						Neon
						
					
			
				
						Prisma Postgres
						
					
			
				
						Sentry
						
					
			
				
						Supabase
						
					
			
				
						Turso
						
					
			
				
						Xata
- Backend services overview
- Appwrite
- Firebase
- Neon
- Prisma Postgres
- Sentry
- Supabase
- Turso
- Xata
- Image and video hosting
								
							
							
	



						
						
	
				
						Media hosting overview
						
					
			
				
						Cloudinary
						
					
			
				
						Mux
- Media hosting overview
- Cloudinary
- Mux
- E-commerce
- Authentication
- Testing
## Sponsored by

## Sponsored by

- Overview
- Imports from astro:actions
				
				
	
				
					defineAction()
				
				
	
				
					handler() property
				
				
			
				
					input validator
				
				
			
				
					accept property
				
				
			

			
				
					actions
				
				
			
				
					isInputError()
				
				
			
				
					isActionError()
				
				
			
				
					ActionError
				
				
	
				
					code
				
				
			
				
					message
				
				
			
				
					stack
				
				
			

			
				
					getActionContext()
				
				
	
				
					action
				
				
	
				
					calledFrom
				
				
			
				
					name
				
				
			
				
					handler()
				
				
			

			
				
					setActionResult()
				
				
			
				
					serializeActionResult()
				
				
			
				
					deserializeActionResult()
				
				
			

			
				
					getActionPath()
				
				
			
				
					ACTION_QUERY_PARAMS
- defineAction()
				
				
	
				
					handler() property
				
				
			
				
					input validator
				
				
			
				
					accept property
- handler() property
- input validator
- accept property
- actions
- isInputError()
- isActionError()
- ActionError
				
				
	
				
					code
				
				
			
				
					message
				
				
			
				
					stack
- code
- message
- stack
- getActionContext()
				
				
	
				
					action
				
				
	
				
					calledFrom
				
				
			
				
					name
				
				
			
				
					handler()
				
				
			

			
				
					setActionResult()
				
				
			
				
					serializeActionResult()
				
				
			
				
					deserializeActionResult()
- action
				
				
	
				
					calledFrom
				
				
			
				
					name
				
				
			
				
					handler()
- calledFrom
- name
- handler()
- setActionResult()
- serializeActionResult()
- deserializeActionResult()
- getActionPath()
- ACTION_QUERY_PARAMS
- astro:actions types
				
				
	
				
					ActionAPIContext
				
				
			
				
					ActionClient
				
				
	
				
					queryString property
				
				
			
				
					orThrow() property
				
				
			

			
				
					ActionErrorCode
				
				
			
				
					ActionInputSchema
				
				
			
				
					ActionReturnType
				
				
			
				
					SafeResult
- ActionAPIContext
- ActionClient
				
				
	
				
					queryString property
				
				
			
				
					orThrow() property
- queryString property
- orThrow() property
- ActionErrorCode
- ActionInputSchema
- ActionReturnType
- SafeResult
## On this page

- Overview
- Imports from astro:actions
defineAction()
handler() property
input validator
accept property
actions
isInputError()
isActionError()
ActionError
code
message
stack
getActionContext()
action
calledFrom
name
handler()
setActionResult()
serializeActionResult()
deserializeActionResult()
getActionPath()
ACTION_QUERY_PARAMS
- defineAction()
handler() property
input validator
accept property
- handler() property
- input validator
- accept property
- actions
- isInputError()
- isActionError()
- ActionError
code
message
stack
- code
- message
- stack
- getActionContext()
action
calledFrom
name
handler()
setActionResult()
serializeActionResult()
deserializeActionResult()
- action
calledFrom
name
handler()
- calledFrom
- name
- handler()
- setActionResult()
- serializeActionResult()
- deserializeActionResult()
- getActionPath()
- ACTION_QUERY_PARAMS
- astro:actions types
ActionAPIContext
ActionClient
queryString property
orThrow() property
ActionErrorCode
ActionInputSchema
ActionReturnType
SafeResult
- ActionAPIContext
- ActionClient
queryString property
orThrow() property
- queryString property
- orThrow() property
- ActionErrorCode
- ActionInputSchema
- ActionReturnType
- SafeResult
## Learn Astro with James Q Quick

Build your first site with 35 interactive Scrimba lessons

# Actions API Reference

Added in: astro@4.15.0

```
astro@4.15.0
```

Actions help you build a type-safe backend you can call from client code and HTML forms. All utilities to define and call actions are exposed by the astro:actions module. For examples and usage instructions, see the Actions guide.

```
astro:actions
```

## Imports from astro:actions

```
astro:actions
```

```
import {
  ACTION_QUERY_PARAMS,
  ActionError,
  actions,
  defineAction,
  getActionContext,
  getActionPath,
  isActionError,
  isInputError,
 } from 'astro:actions';
```

```
import {
  ACTION_QUERY_PARAMS,
  ActionError,
  actions,
  defineAction,
  getActionContext,
  getActionPath,
  isActionError,
  isInputError,
 } from 'astro:actions';
```

### defineAction()

```
defineAction()
```

Type: ({ accept, input, handler }) => ActionClient

```
({ accept, input, handler }) => ActionClient
```

A utility to define new actions in the src/actions/index.ts file. This accepts a handler() function containing the server logic to run, and an optional input property to validate input parameters at runtime.

```
src/actions/index.ts
```

```
handler()
```

```
input
```

```
import { defineAction } from 'astro:actions';
import { z } from 'astro:schema';


export const server = {
  getGreeting: defineAction({
    input: z.object({
      name: z.string(),
    }),
    handler: async (input, context) => {
      return `Hello, ${input.name}!`
    }
  })
}
```

```
import { defineAction } from 'astro:actions';
import { z } from 'astro:schema';


export const server = {
  getGreeting: defineAction({
    input: z.object({
      name: z.string(),
    }),
    handler: async (input, context) => {
      return `Hello, ${input.name}!`
    }
  })
}
```

#### handler() property

```
handler()
```

Type: (input: TInputSchema, context: ActionAPIContext) => TOutput | Promise<TOutput>

```
(input: TInputSchema, context: ActionAPIContext) => TOutput | Promise<TOutput>
```

A required function containing the server logic to run when the action is called. Data returned from the handler() is automatically serialized and sent to the caller.

```
handler()
```

The handler() is called with user input as its first argument. If an input validator is set, the user input will be validated before being passed to the handler. The second argument is a subset of Astro’s context object.

```
handler()
```

```
input
```

```
context
```

Return values are parsed using the devalue library. This supports JSON values and instances of Date(), Map(), Set(), and URL().

```
Date()
```

```
Map()
```

```
Set()
```

```
URL()
```

#### input validator

```
input
```

Type: ZodType | undefined

```
ZodType | undefined
```

An optional property that accepts a Zod validator (e.g. Zod object, Zod discriminated union) to validate handler inputs at runtime. If the action fails to validate, a BAD_REQUEST error is returned and the handler is not called.

```
BAD_REQUEST
```

```
handler
```

If input is omitted, the handler will receive an input of type unknown for JSON requests and type FormData for form requests.

```
input
```

```
handler
```

```
unknown
```

```
FormData
```

#### accept property

```
accept
```

Type: "form" | "json"
Default: json

```
"form" | "json"
```

```
json
```

Defines the format expected by an action:

- Use form when your action accepts FormData.
```
form
```

```
FormData
```

- Use json, the default, for all other cases.
```
json
```

When your action accepts form inputs, the z.object() validator will automatically parse FormData to a typed object. All Zod validators are supported to validate your inputs.

```
z.object()
```

```
FormData
```

### actions

```
actions
```

Type: Record<string, ActionClient>

```
Record<string, ActionClient>
```

An object containing all your actions with the action name as key associated to a function to call this action.

```
---
---


<script>
import { actions } from 'astro:actions';


async () => {
  const { data, error } = await actions.myAction({ /* ... */ });
}
</script>
```

```
---
---


<script>
import { actions } from 'astro:actions';


async () => {
  const { data, error } = await actions.myAction({ /* ... */ });
}
</script>
```

In order for Astro to recognize this property, you may need to restart the dev server or run the astro sync command (s + enter).

```
astro sync
```

```
s + enter
```

### isInputError()

```
isInputError()
```

Type: (error?: unknown) => boolean

```
(error?: unknown) => boolean
```

A utility used to check whether an ActionError is an input validation error. When the input validator is a z.object(), input errors include a fields object with error messages grouped by name.

```
ActionError
```

```
input
```

```
z.object()
```

```
fields
```

```
isInputError()
```

### isActionError()

```
isActionError()
```

Type: (error?: unknown) => boolean

```
(error?: unknown) => boolean
```

A utility to check whether your action raised an ActionError within the handler property. This is useful when narrowing the type of a generic error.

```
ActionError
```

```
---
---


<script>
import { isActionError, actions } from 'astro:actions';


async () => {
  const { data, error } = await actions.myAction({ /* ... */ });
  if (isActionError(error)) {
    // Handle action-specific errors
    console.log(error.code);
  }
}
</script>
```

```
---
---


<script>
import { isActionError, actions } from 'astro:actions';


async () => {
  const { data, error } = await actions.myAction({ /* ... */ });
  if (isActionError(error)) {
    // Handle action-specific errors
    console.log(error.code);
  }
}
</script>
```

### ActionError

```
ActionError
```

The ActionError() constructor is used to create errors thrown by an action handler. This accepts a code property describing the error that occurred (example: "UNAUTHORIZED"), and an optional message property with further details.

```
ActionError()
```

```
handler
```

```
code
```

```
"UNAUTHORIZED"
```

```
message
```

The following example creates a new ActionError when the user is not logged in:

```
ActionError
```

```
import { defineAction, ActionError } from "astro:actions";


export const server = {
  getUserOrThrow: defineAction({
    accept: 'form',
    handler: async (_, { locals }) => {
      if (locals.user?.name !== 'florian') {
        throw new ActionError({
          code: 'UNAUTHORIZED',
          message: 'Not logged in',
        });
      }
      return locals.user;
    },
  }),
}
```

```
import { defineAction, ActionError } from "astro:actions";


export const server = {
  getUserOrThrow: defineAction({
    accept: 'form',
    handler: async (_, { locals }) => {
      if (locals.user?.name !== 'florian') {
        throw new ActionError({
          code: 'UNAUTHORIZED',
          message: 'Not logged in',
        });
      }
      return locals.user;
    },
  }),
}
```

You can also use ActionError to narrow the error type when handling the results of an action:

```
ActionError
```

```
---
---


<script>
import { ActionError, actions } from 'astro:actions';


async () => {
  const { data, error } = await actions.myAction({ /* ... */ });
  if (error instanceof ActionError) {
    // Handle action-specific errors
    console.log(error.code);
  }
}
</script>
```

```
---
---


<script>
import { ActionError, actions } from 'astro:actions';


async () => {
  const { data, error } = await actions.myAction({ /* ... */ });
  if (error instanceof ActionError) {
    // Handle action-specific errors
    console.log(error.code);
  }
}
</script>
```

#### code

```
code
```

Type: ActionErrorCode

```
ActionErrorCode
```

Defines a human-readable version of an HTTP status code.

#### message

```
message
```

Type: string

```
string
```

An optional property to describe the error (e.g. “User must be logged in.”).

#### stack

```
stack
```

Type: string

```
string
```

An optional property to pass the stack trace.

### getActionContext()

```
getActionContext()
```

Type: (context: APIContext) => AstroActionContext

```
(context: APIContext) => AstroActionContext
```

```
astro@5.0.0
```

A function called from your middleware handler to retrieve information about inbound action requests. This returns an action object with information about the request, a deserializeActionResult() method, and the setActionResult() and serializeActionResult() functions to programmatically set the value returned by Astro.getActionResult().

```
action
```

```
deserializeActionResult()
```

```
setActionResult()
```

```
serializeActionResult()
```

```
Astro.getActionResult()
```

getActionContext() lets you programmatically get and set action results using middleware, allowing you to persist action results from HTML forms, gate action requests with added security checks, and more.

```
getActionContext()
```

```
import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';


export const onRequest = defineMiddleware(async (context, next) => {
  const { action, setActionResult, serializeActionResult } = getActionContext(context);
  if (action?.calledFrom === 'form') {
    const result = await action.handler();
    setActionResult(action.name, serializeActionResult(result));
  }
  return next();
});
```

```
import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';


export const onRequest = defineMiddleware(async (context, next) => {
  const { action, setActionResult, serializeActionResult } = getActionContext(context);
  if (action?.calledFrom === 'form') {
    const result = await action.handler();
    setActionResult(action.name, serializeActionResult(result));
  }
  return next();
});
```

#### action

```
action
```

Type: { calledFrom: “rpc” | “form”; name: string; handler: () => Promise<SafeResult>; } | undefined

```
{ calledFrom: “rpc” | “form”; name: string; handler: () => Promise<SafeResult>; } | undefined
```

An object containing information about an inbound action request. It is available from getActionContext(), and provides the action name, handler, and whether the action was called from a client-side RPC function (e.g. actions.newsletter()) or an HTML form action.

```
getActionContext()
```

```
name
```

```
handler
```

```
actions.newsletter()
```

```
import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';


export const onRequest = defineMiddleware(async (context, next) => {
  const { action, setActionResult, serializeActionResult } = getActionContext(context);
  if (action?.calledFrom === 'rpc' && action.name.startsWith('private')) {
    // Check for a valid session token
  }
  // ...
});
```

```
import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';


export const onRequest = defineMiddleware(async (context, next) => {
  const { action, setActionResult, serializeActionResult } = getActionContext(context);
  if (action?.calledFrom === 'rpc' && action.name.startsWith('private')) {
    // Check for a valid session token
  }
  // ...
});
```

##### calledFrom

```
calledFrom
```

Type: "rpc" | "form"

```
"rpc" | "form"
```

Whether an action was called using an RPC function or an HTML form action.

##### name

```
name
```

Type: string

```
string
```

The name of the action. Useful to track the source of an action result during a redirect.

##### handler()

```
handler()
```

Type: () => Promise<SafeResult>

```
() => Promise<SafeResult>
```

A method to programmatically call an action to get the result.

#### setActionResult()

```
setActionResult()
```

Type: (actionName: string, actionResult: SerializedActionResult) => void

```
(actionName: string, actionResult: SerializedActionResult) => void
```

A function to programmatically set the value returned by Astro.getActionResult() in middleware. It is passed the action name and an action result serialized by serializeActionResult(). Calling this function from middleware will disable Astro’s own action result handling.

```
Astro.getActionResult()
```

```
serializeActionResult()
```

This is useful when calling actions from an HTML form to persist and load results from a session.

```
import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';
export const onRequest = defineMiddleware(async (context, next) => {
  const { action, setActionResult, serializeActionResult } = getActionContext(context);
  if (action?.calledFrom === 'form') {
    const result = await action.handler();
    // ... handle the action result
    setActionResult(action.name, serializeActionResult(result));
  }
  return next();
});
```

```
import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';
export const onRequest = defineMiddleware(async (context, next) => {
  const { action, setActionResult, serializeActionResult } = getActionContext(context);
  if (action?.calledFrom === 'form') {
    const result = await action.handler();
    // ... handle the action result
    setActionResult(action.name, serializeActionResult(result));
  }
  return next();
});
```

#### serializeActionResult()

```
serializeActionResult()
```

Type: (res: SafeResult) => SerializedActionResult

```
(res: SafeResult) => SerializedActionResult
```

Serializes an action result to JSON for persistence. This is required to properly handle non-JSON return values like Map or Date as well as the ActionError object.

```
Map
```

```
Date
```

```
ActionError
```

Call this function when serializing an action result to be passed to setActionResult():

```
setActionResult()
```

```
import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';


export const onRequest = defineMiddleware(async (context, next) => {
  const { action, setActionResult, serializeActionResult } = getActionContext(context);
  if (action) {
    const result = await action.handler();
    setActionResult(action.name, serializeActionResult(result));
  }
  // ...
});
```

```
import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';


export const onRequest = defineMiddleware(async (context, next) => {
  const { action, setActionResult, serializeActionResult } = getActionContext(context);
  if (action) {
    const result = await action.handler();
    setActionResult(action.name, serializeActionResult(result));
  }
  // ...
});
```

#### deserializeActionResult()

```
deserializeActionResult()
```

Type: (res: SerializedActionResult) => SafeResult

```
(res: SerializedActionResult) => SafeResult
```

Reverses the effect of serializeActionResult() and returns an action result to its original state. This is useful to access the data and error objects on a serialized action result.

```
serializeActionResult()
```

```
data
```

```
error
```

### getActionPath()

```
getActionPath()
```

Type: (action: ActionClient) => string

```
(action: ActionClient) => string
```

```
astro@5.1.0
```

A utility that accepts an action and returns a URL path so you can execute an action call as a fetch() operation directly. This allows you to provide details such as custom headers when you call your action. Then, you can handle the custom-formatted returned data as needed, just as if you had called an action directly.

```
fetch()
```

This example shows how to call a defined like action passing the Authorization header and the keepalive option:

```
like
```

```
Authorization
```

```
keepalive
```

```
<script>
import { actions, getActionPath } from 'astro:actions'


await fetch(getActionPath(actions.like), {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    Authorization: 'Bearer YOUR_TOKEN'
  },
  body: JSON.stringify({ id: 'YOUR_ID' }),
  keepalive: true
})
</script>
```

```
<script>
import { actions, getActionPath } from 'astro:actions'


await fetch(getActionPath(actions.like), {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    Authorization: 'Bearer YOUR_TOKEN'
  },
  body: JSON.stringify({ id: 'YOUR_ID' }),
  keepalive: true
})
</script>
```

This example shows how to call the same like action using the sendBeacon API:

```
like
```

```
sendBeacon
```

```
<script>
import { actions, getActionPath } from 'astro:actions'


navigator.sendBeacon(
  getActionPath(actions.like),
  new Blob([JSON.stringify({ id: 'YOUR_ID' })], {
    type: 'application/json'
  })
)
</script>
```

```
<script>
import { actions, getActionPath } from 'astro:actions'


navigator.sendBeacon(
  getActionPath(actions.like),
  new Blob([JSON.stringify({ id: 'YOUR_ID' })], {
    type: 'application/json'
  })
)
</script>
```

### ACTION_QUERY_PARAMS

```
ACTION_QUERY_PARAMS
```

Type: { actionName: string, actionPayload: string }

```
{ actionName: string, actionPayload: string }
```

An object containing the query parameter names used internally by Astro when handling form action submissions.

When you submit a form using an action, the following query parameters are added to the URL to track the action call:

- actionName - The query parameter that contains the name of the action being called
```
actionName
```

- actionPayload - The query parameter that contains the serialized form data
```
actionPayload
```

This constant can be useful when you need to clean up URLs after a form submission. For example, you might want to remove action-related query parameters during a redirect:

```
import type { APIRoute } from "astro";
import { ACTION_QUERY_PARAMS } from 'astro:actions'


export const GET: APIRoute = ({ params, request }) => {
  const link = request.url.searchParams;
  link.delete(ACTION_QUERY_PARAMS.actionName);
  link.delete(ACTION_QUERY_PARAMS.actionPayload);


  return redirect(link, 303);
};
```

```
import type { APIRoute } from "astro";
import { ACTION_QUERY_PARAMS } from 'astro:actions'


export const GET: APIRoute = ({ params, request }) => {
  const link = request.url.searchParams;
  link.delete(ACTION_QUERY_PARAMS.actionName);
  link.delete(ACTION_QUERY_PARAMS.actionPayload);


  return redirect(link, 303);
};
```

## astro:actions types

```
astro:actions
```

```
import type {
  ActionAPIContext,
  ActionClient,
  ActionErrorCode,
  ActionInputSchema,
  ActionReturnType,
  SafeResult,
 } from 'astro:actions';
```

```
import type {
  ActionAPIContext,
  ActionClient,
  ActionErrorCode,
  ActionInputSchema,
  ActionReturnType,
  SafeResult,
 } from 'astro:actions';
```

### ActionAPIContext

```
ActionAPIContext
```

A subset of the Astro context object. The following properties are not available: callAction, getActionResult, props, and redirect.

```
callAction
```

```
getActionResult
```

```
props
```

```
redirect
```

### ActionClient

```
ActionClient
```

Types:

- (input?: any) => Promise<SafeResult>
```
(input?: any) => Promise<SafeResult>
```

- { queryString?: string; orThrow: (input?: any) => Promise<Awaited<TOutput>>; }
```
{ queryString?: string; orThrow: (input?: any) => Promise<Awaited<TOutput>>; }
```

Represents an action to be called on the client. You can use it as a function that accepts input data and returns a Promise with a SafeResult object containing the action result or validation errors.

```
SafeResult
```

The following example shows how you can provide error handling with an if statement when incrementing the like count fails:

```
if
```

```
---
---


<!-- your template -->


<script>
import { actions } from 'astro:actions';


const post = document.querySelector('article');
const button = document.querySelector('button');
button?.addEventListener('click', async () => {
  const { data: updatedLikes, error } = await actions.likePost({ postId: post?.id });
  if (error) {
    /* handle errors */
  }
})
</script>
```

```
---
---


<!-- your template -->


<script>
import { actions } from 'astro:actions';


const post = document.querySelector('article');
const button = document.querySelector('button');
button?.addEventListener('click', async () => {
  const { data: updatedLikes, error } = await actions.likePost({ postId: post?.id });
  if (error) {
    /* handle errors */
  }
})
</script>
```

Alternatively, you can use it as an object giving you access to the queryString and an alternative orThrow() method.

```
queryString
```

```
orThrow()
```

#### queryString property

```
queryString
```

Type: string

```
string
```

A string representation of the action that can be used to construct form action URLs. This can be useful when your form component is used in multiple places but you need to redirect to a different URL on submit.

The following example uses queryString to construct a URL that will be passed to the form action attribute through a custom prop:

```
queryString
```

```
action
```

```
---
import { actions } from 'astro:actions';
import FeedbackForm from "../components/FeedbackForm.astro";


const feedbackUrl = new URL('/feedback', Astro.url);
feedbackUrl.search = actions.myAction.queryString;
---
<FeedbackForm sendTo={feedbackUrl.pathname} />
```

```
---
import { actions } from 'astro:actions';
import FeedbackForm from "../components/FeedbackForm.astro";


const feedbackUrl = new URL('/feedback', Astro.url);
feedbackUrl.search = actions.myAction.queryString;
---
<FeedbackForm sendTo={feedbackUrl.pathname} />
```

#### orThrow() property

```
orThrow()
```

Type: (input?: any) => Promise<Awaited<TOutput>>

```
(input?: any) => Promise<Awaited<TOutput>>
```

A method that throws an error on failure instead of returning the errors. This is useful when you want exceptions rather than error handling.

The following example uses orThrow() to skip error handling when incrementing the like count fails:

```
orThrow()
```

```
---
---


<!-- your template -->


<script>
import { actions } from 'astro:actions';


const post = document.querySelector('article');
const button = document.querySelector('button');
button?.addEventListener('click', async () => {
  const updatedLikes = await actions.likePost.orThrow({ postId: post?.id });
})
</script>
```

```
---
---


<!-- your template -->


<script>
import { actions } from 'astro:actions';


const post = document.querySelector('article');
const button = document.querySelector('button');
button?.addEventListener('click', async () => {
  const updatedLikes = await actions.likePost.orThrow({ postId: post?.id });
})
</script>
```

### ActionErrorCode

```
ActionErrorCode
```

Type: string

```
string
```

A union type of standard HTTP status codes defined by IANA using the human-readable versions as uppercase strings separated by an underscore (e.g. BAD_REQUEST or PAYLOAD_TOO_LARGE).

```
BAD_REQUEST
```

```
PAYLOAD_TOO_LARGE
```

### ActionInputSchema

```
ActionInputSchema
```

Type: ZodType

```
ZodType
```

```
astro@5.16.0
```

A utility type that automatically infers the TypeScript type of an action’s input based on its Zod schema. This can be useful to reference an action’s input validator type as an object in your own type definitions.

```
input
```

Returns never when input validator is omitted.

```
never
```

```
input
```

The following example uses ActionInputSchema on an action named contact to:

```
ActionInputSchema
```

```
contact
```

- Retrieve the Zod schema type for the input of the action.
- Retrieve the expected input type of the action’s validator.
```
---
import { actions, ActionInputSchema } from 'astro:actions';
import { z } from 'astro/zod';


type ContactSchema = ActionInputSchema<typeof actions.contact>;
type ContactInput = z.input<ContactSchema>;
---
```

```
---
import { actions, ActionInputSchema } from 'astro:actions';
import { z } from 'astro/zod';


type ContactSchema = ActionInputSchema<typeof actions.contact>;
type ContactInput = z.input<ContactSchema>;
---
```

### ActionReturnType

```
ActionReturnType
```

Type: Awaited<ReturnType<ActionHandler>>

```
Awaited<ReturnType<ActionHandler>>
```

A utility type that extracts the output type from an action handler. This unwraps both the Promise (if the handler is async) and the ReturnType to give you the actual output type. This can be useful if you need to reference an action’s output type in your own type definitions.

```
Promise
```

```
ReturnType
```

The following example uses ActionReturnType to retrieve the expected output type for an action named contact:

```
ActionReturnType
```

```
contact
```

```
---
import { actions, ActionReturnType } from 'astro:actions';


type ContactResult = ActionReturnType<typeof actions.contact>;
---
```

```
---
import { actions, ActionReturnType } from 'astro:actions';


type ContactResult = ActionReturnType<typeof actions.contact>;
---
```

### SafeResult

```
SafeResult
```

Type: { data: TOutput, error: undefined } | { data: undefined, error: ActionError }

```
{ data: TOutput, error: undefined } | { data: undefined, error: ActionError }
```

Represents the result of an action call:

- on success, data contains the output of the action and error is undefined.
```
data
```

```
error
```

```
undefined
```

- on failure, error contains an ActionError with validation errors or runtime errors, and data is undefined.
```
error
```

```
ActionError
```

```
data
```

```
undefined
```

## Learn Astro with Coding in Public

150+ video lessons
			
			•
			Astro v5 ready

